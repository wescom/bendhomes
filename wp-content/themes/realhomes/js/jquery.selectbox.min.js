if(jQuery.fn.extend({selectbox:function(e){return this.each(function(){new jQuery.SelectBox(this,e)})}}),!window.console)var console={log:function(e){}};jQuery.SelectBox=function(e,t){function s(){p=0,v.hide()}function n(){v.append(c(m.attr("id"))).hide();m.css("width");v.height()>d.maxHeight&&v.height(d.maxHeight)}function a(e){var t=document.createElement("div");return v=jQuery(t),v.attr("id",h+"_container"),v.addClass(e.containerClass),v.css("display","none"),v}function o(e){if("span"==d.inputType){var t=document.createElement("span"),s=jQuery(t);s.attr("id",h+"_input"),s.addClass(e.inputClass),s.attr("tabIndex",f.attr("tabindex"))}else{var t=document.createElement("input"),s=jQuery(t);s.attr("id",h+"_input"),s.attr("type","text"),s.addClass(e.inputClass),s.attr("autocomplete","off"),s.attr("readonly","readonly"),s.attr("tabIndex",f.attr("tabindex"))}return s}function r(e){var t=jQuery("li",v);if(!t||0==t.length)return!1;for(firstchoice=0;u(t[firstchoice]).hasClass(d.groupClass);)firstchoice++;C+=e,u(t[C]).hasClass(d.groupClass)&&(C+=e),C<firstchoice?C=d.loopnoStep?t.size()-1:t.size():d.loopnoStep&&C>t.size()-1?C=firstchoice:C>t.size()&&(C=firstchoice),l(t,C),t.removeClass(d.hoverClass),jQuery(t[C]).addClass(d.hoverClass)}function l(e,t){var s=jQuery(e[t]).get(0),e=v.get(0);s.offsetTop+s.offsetHeight>e.scrollTop+e.clientHeight?e.scrollTop=s.offsetTop+s.offsetHeight-e.clientHeight:s.offsetTop<e.scrollTop&&(e.scrollTop=s.offsetTop)}function i(){var e=jQuery("li."+d.currentClass,v).get(0),t=(""+e.id).split("_"),s=t[t.length-1];return d.onChangeCallback?(f.get(0).selectedIndex=u("li",v).index(e),d.onChangeParams={selectedVal:f.val()},d.onChangeCallback(d.onChangeParams)):(f.val(s),f.change()),"span"==d.inputType?m.html(u(e).html()):m.val(u(e).html()),!0}function c(e){var t=new Array,n=document.createElement("ul");if(t=f.children("option"),0==t.length){var a=new Array;for(a=f.children("optgroup"),x=0;x<a.length;x++){t=u("#"+a[x].id).children("option");var o=document.createElement("li");o.setAttribute("id",e+"_"+u(this).val()),o.innerHTML=u("#"+a[x].id).attr("label"),o.className=d.groupClass,n.appendChild(o),t.each(function(){var t=document.createElement("li");t.setAttribute("id",e+"_"+u(this).val()),t.innerHTML=u(this).html(),u(this).is(":selected")&&(m.html(u(this).html()),u(t).addClass(d.currentClass)),n.appendChild(t),u(t).mouseover(function(e){p=1,d.debug&&console.log("over on : "+this.id),jQuery(e.target,v).addClass(d.hoverClass)}).mouseout(function(e){p=-1,d.debug&&console.log("out on : "+this.id),jQuery(e.target,v).removeClass(d.hoverClass)}).click(function(e){u("li."+d.hoverClass,v).get(0);d.debug&&console.log("click on :"+this.id),u("li."+d.currentClass,v).removeClass(d.currentClass),u(this).addClass(d.currentClass),i(),f.get(0).blur(),s()})})}}else t.each(function(){var t=document.createElement("li");t.setAttribute("id",e+"_"+u(this).val()),t.innerHTML=u(this).html(),u(this).is(":selected")&&(m.val(u(this).html()),u(t).addClass(d.currentClass)),n.appendChild(t),u(t).mouseover(function(e){p=1,d.debug&&console.log("over on : "+this.id),jQuery(e.target,v).addClass(d.hoverClass)}).mouseout(function(e){p=-1,d.debug&&console.log("out on : "+this.id),jQuery(e.target,v).removeClass(d.hoverClass)}).click(function(e){u("li."+d.hoverClass,v).get(0);d.debug&&console.log("click on :"+this.id),u("li."+d.currentClass,v).removeClass(d.currentClass),u(this).addClass(d.currentClass),i(),f.get(0).blur(),s()})});return n}var u=jQuery,d=t||{};d.inputType=d.inputType||"input",d.inputClass=d.inputClass||"selectbox",d.containerClass=d.containerClass||"selectbox-wrapper",d.hoverClass=d.hoverClass||"current",d.currentClass=d.currentClass||"selected",d.groupClass=d.groupClass||"groupname",d.maxHeight=d.maxHeight||200,d.loopnoStep=d.loopnoStep||!1,d.onChangeCallback=d.onChangeCallback||!1,d.onChangeParams=d.onChangeParams||!1,d.debug=d.debug||!1;var h=e.id,C=0,g=!1,p=0,f=jQuery(e),v=a(d),m=o(d);f.hide().before(m).before(v),n(),m.click(function(){g||v.toggle()}).focus(function(){v.not(":visible")&&(g=!0,v.show())}).keydown(function(e){switch(e.keyCode){case 38:e.preventDefault(),r(-1);break;case 40:e.preventDefault(),r(1);break;case 13:e.preventDefault(),u("li."+d.hoverClass).trigger("click");break;case 27:s()}}).blur(function(){v.is(":visible")&&p>0?d.debug&&console.log("container visible and has focus"):jQuery.browser.msie&&jQuery.browser.version.substr(0,1)<8||jQuery.browser.safari&&!/chrome/.test(navigator.userAgent.toLowerCase())?-1==document.activeElement.getAttribute("id").indexOf("_container")?s():m.focus():s()})};